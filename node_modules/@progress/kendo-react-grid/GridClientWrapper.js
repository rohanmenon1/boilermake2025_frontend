/**
 * @license
 *-------------------------------------------------------------------------------------------
 * Copyright Â© 2025 Progress Software Corporation. All rights reserved.
 * Licensed under commercial license. See LICENSE.md in the package root for more information
 *-------------------------------------------------------------------------------------------
 */
"use client";
"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const Mt=require("react"),b=require("@progress/kendo-react-common"),l=require("@progress/kendo-react-data-tools"),Tt=require("./drag/ColumnResize.js"),At=require("./drag/CommonDragLogic.js"),Ht=require("./constants/index.js"),w=require("./utils/index.js"),Ae=require("./VirtualScrollFixed.js"),Gt=require("./VirtualScroll.js"),Ft=require("./contextMenu/GridContextMenu.js"),He=require("./contextMenu/enums.js"),Ge=require("./sortCommon.js");function Lt(t){const v=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const h in t)if(h!=="default"){const H=Object.getOwnPropertyDescriptor(t,h);Object.defineProperty(v,h,H.get?H:{enumerable:!0,get:()=>t[h]})}}return v.default=t,Object.freeze(v)}const i=Lt(Mt),Fe=i.createContext(void 0),Ot=t=>{var Se,De;const v=t.gridProps.isClient,[h,H]=i.useState({}),Le=e=>{e.event.preventDefault(),H({...h,show:!0,offset:{left:e.event.pageX,top:e.event.pageY},dataItem:e.dataItem,field:e.field})},me=()=>{H({})},I=i.useMemo(()=>t.columnsRef.current.find(e=>e.field===h.field),[t.columnsRef,h]),Pe=i.useMemo(()=>{const e=t.gridProps.sortable&&(I==null?void 0:I.sortable);return w.getDefaultHeadContextMenuItems({sortable:!!e,selectable:l.getSelectionOptions(t.gridProps.selectable).enabled,clipboard:!!t.gridProps.clipboard})},[I,t.gridProps.sortable,t.gridProps.selectable,t.gridProps.clipboard]),he=i.useMemo(()=>{const e=t.gridProps.sortable&&(I==null?void 0:I.sortable);return w.getDefaultBodyContextMenuItems({sortable:!!e,selectable:l.getSelectionOptions(t.gridProps.selectable).enabled,clipboard:!!t.gridProps.clipboard,rowReorderable:w.isRowReorderEnabled(t.gridProps.rowReorderable)})},[I,t.gridProps.sortable,t.gridProps.selectable,t.gridProps.clipboard]),Oe=i.useMemo(()=>{const e=(I==null?void 0:I.contextMenu)||t.gridProps.contextMenu,r=typeof e=="function"?e(h):e;if(r&&h.offset){const n=h.dataItem?He.GridContextMenuAnchorPart.body:He.GridContextMenuAnchorPart.head,a=r[n],o=h.dataItem?he:Pe;return a===!1?void 0:a===!0||a===void 0?o:a}},[t.gridProps.contextMenu,h,he,Pe,I]),ze=e=>{var s,m,P,u,y,ke,Ke,Me,Te;const r=e.event.item,n={target:E.current,syntheticEvent:e.event.syntheticEvent,nativeEvent:e.event.nativeEvent,menuItem:r,...e};t.gridProps.onContextMenuItemClick&&g(t.gridProps.onContextMenuItemClick,n);const a=B(),o={selectedField:t.gridProps.selectedField||"",componentId:t.id,dataItems:a,dataItem:e.dataItem,startRowIndex:-1,endRowIndex:-1,startColIndex:-1,endColIndex:-1,ctrlKey:!1,altKey:!1,metaKey:!1,shiftKey:!1,isDrag:!1,...l.getSelectionOptions(t.gridProps.selectable),...n},c=a.findIndex(fe=>fe===e.dataItem);switch((s=r.data)==null?void 0:s.action){case"SortCommand":if(I){const fe=(m=r.name)==null?void 0:m.toLowerCase().includes("asc"),Dt=((P=r.name)==null?void 0:P.toLowerCase().includes("desc"))?"desc":void 0,kt=fe?"asc":Dt,Kt=r.name?kt:void 0;be(e.event.syntheticEvent,I,Kt)}break;case"SelectRowCommand":et(o);break;case"SelectAllRowsCommand":pe(o);break;case"ClearSelectionCommand":tt(o);break;case"ReorderRowCommand":N.current=e.dataItem,(u=r.name)!=null&&u.toLowerCase().includes("rowup")&&c>0&&F(e.event.syntheticEvent,c-1,"before"),(y=r.name)!=null&&y.toLowerCase().includes("rowdown")&&c<a.length-1&&F(e.event.syntheticEvent,c+1,"after"),(ke=r.name)!=null&&ke.toLowerCase().includes("rowtop")&&F(e.event.syntheticEvent,0,"before"),(Ke=r.name)!=null&&Ke.toLowerCase().includes("rowbottom")&&F(e.event.syntheticEvent,a.length-1,"after");break;case"CopySelectionCommand":W(l.ClipboardActionType.copy,e.event.nativeEvent,{copyHeaders:!((Me=r.name)!=null&&Me.toLowerCase().includes("noheaders"))},e.dataItem,e.field);break;case"PasteCommand":W(l.ClipboardActionType.paste,e.event.nativeEvent,{copyHeaders:!((Te=r.name)!=null&&Te.toLowerCase().includes("noheaders"))},e.dataItem,e.field);break}me()},q=()=>{const e=f.current.filter(r=>r.declarationIndex>=0&&r.parentIndex===-1);return w.sanitizeColumns(e)},Ne=(e,r,n)=>{if(t.gridProps.onContextMenu&&v){const a={target:E.current,syntheticEvent:e,nativeEvent:e.nativeEvent,dataItem:r,field:n};g(t.gridProps.onContextMenu,a)}t.gridProps.contextMenu&&Le({event:e,dataItem:r,field:n})},qe=e=>{if(e.target!==e.currentTarget)return;clearTimeout(se.current),d.current&&(d.current.table=k.current);const r=e.currentTarget.scrollLeft,n=e.currentTarget.scrollTop,a=t.gridProps.scrollable==="virtual";t.gridProps.columnVirtualization&&(!a||n===le.current)&&(se.current=window.setTimeout(()=>{re()},0)),t.gridProps.scrollLeftRef&&(t.gridProps.scrollLeftRef.current=r),z.current&&z.current.setScrollLeft(r),O.current&&O.current.setScrollLeft(r),d.current&&n!==le.current&&d.current.scrollHandler(e),t.gridProps.onScroll&&v&&g(t.gridProps.onScroll,{...C(e)}),le.current=n},Ue=e=>{var n,a;l.tableKeyboardNavigation.onKeyDown(e,{navigatable:t.gridProps.navigatable||!1,contextStateRef:D,navigationStateRef:M,onNavigationAction:We,columns:q()}),l.tableKeyboardNavigation.onGetSnapshotBeforeUpdate({document:x(),contextStateRef:D,navigationStateRef:M});const r={dataItems:_(),mode:R.mode,cell:R.cell,componentId:t.id,selectedField:t.gridProps.selectedField,...C(e)};if(t.gridProps.onKeyDown&&v&&g(t.gridProps.onKeyDown,r),!t.gridProps.selectedField&&R.enabled&&t.gridProps.dataItemKey){const o=l.getSelectedStateFromKeyDown({event:r,selectedState:(n=t.gridProps.select)!=null?n:{},dataItemKey:t.gridProps.dataItemKey});if(o===t.gridProps.select)return;const c=e.target,s=l.closestTagName(c,"TD"),m=l.closestTagName(c,"TR"),P=l.getColumnIndex(s),u=l.getRowIndex(m);if(P!==void 0&&u!==void 0){const y=(a=w.getDataAsArray(t.gridProps.data))==null?void 0:a[u];t.gridProps.onSelectionChange&&g(t.gridProps.onSelectionChange,{...r,select:o,dataItem:y,startRowIndex:u,startColIndex:P,startDataItem:y,endDataItem:y,endRowIndex:u,endColIndex:P,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,shiftKey:e.shiftKey,isDrag:!1})}}},Ve=e=>{l.tableKeyboardNavigation.onFocus(e,{navigatable:!!t.gridProps.navigatable,contextStateRef:D})},We=e=>{if(e.action==="moveToNextPage"&&nt(e.event),e.action==="moveToPrevPage"&&at(e.event),e.focusElement&&e.action==="reorderToRight"){const r=parseInt(e.focusElement.ariaColIndex,10)-1;r<f.current.length-1&&Z(r,r+1,e.event)}if(e.focusElement&&e.action==="reorderToLeft"){const r=parseInt(e.focusElement.ariaColIndex,10)-1;r>0&&Z(r,r-1,e.event)}if(t.gridProps.onNavigationAction&&v){const r={focusElement:e.focusElement,...C(e.event)};g(t.gridProps.onNavigationAction,r)}},_e=(e,r)=>{t.gridProps.onRowClick&&e.target.nodeName==="TD"&&g(t.gridProps.onRowClick,{dataItem:r,...C(e)})},Be=(e,r)=>{t.gridProps.onRowDoubleClick&&e.target.nodeName==="TD"&&g(t.gridProps.onRowDoubleClick,{dataItem:r,...C(e)})},je=(e,r,n)=>{if(we.enabled&&we.mode==="incell"&&t.gridProps.dataItemKey){const a=l.editReducer(t.gridProps.edit,{type:l.EDIT_ACTION.ENTER_FIELD_EDIT,payload:{id:r[t.gridProps.dataItemKey],field:n}});t.gridProps.onEditChange&&g(t.gridProps.onEditChange,{edit:a,...C(e)})}},$e=(e,r)=>{var a;if(l.getDetailExpandableOptions(t.detailExpandable).enabled){const o=l.detailExpandReducer((a=t.gridProps.detailExpand)!=null?a:{},e);t.gridProps.onDetailExpandChange&&g(t.gridProps.onDetailExpandChange,{...C(r),detailExpand:o})}},Xe=(e,r)=>{var a;const n=l.getGroupExpandableOptions(typeof t.gridProps.groupable=="object"?t.gridProps.groupable.expandable!==!1:t.gridProps.groupable);if(n.enabled){const o=l.groupExpandReducer((a=t.gridProps.groupExpand)!=null?a:[],e,n);t.gridProps.onGroupExpandChange&&g(t.gridProps.onGroupExpandChange,{...C(r),groupExpand:o})}},be=(e,r,n)=>{const{allowUnsort:a,mode:o}=Ge.normalize(t.gridProps.sortable||!1,r.sortable||!1),c=(t.gridProps.sort||[]).filter(P=>P.field===r.field)[0],s=n||Ge.firstLevelSortSeqMap[a][c&&c.dir||""],m=o==="single"?[]:(t.gridProps.sort||[]).filter(P=>P.field!==r.field);s!==""&&r.field&&m.push({field:r.field,dir:s}),Ie(m,e)},Je=e=>{var r;if(e.field===t.gridProps.expandField||e._expand||t.gridProps.group&&e.field===void 0){if(t.gridProps.onExpandChange){const n=t.gridProps.dataItemKey?l.detailExpandReducer((r=t.gridProps.detailExpand)!=null?r:{},{type:l.DETAIL_EXPAND_ACTION.SET,id:e.dataItem[t.gridProps.dataItemKey],payload:e.value}):t.gridProps.detailExpand;g(t.gridProps.onExpandChange,{...C(e.syntheticEvent),expand:n,dataItem:e.dataItem,dataIndex:e.dataIndex,value:e.value})}return}t.gridProps.onItemChange&&g(t.gridProps.onItemChange,{...C(e.syntheticEvent),dataItem:e.dataItem,dataIndex:e.dataIndex,field:e.field,value:e.value})},Ye=e=>{var r;if(t.gridProps.onSelectionChange&&R.enabled){const{event:n,dataItem:a,dataIndex:o,columnIndex:c}=e,s={...C(n.syntheticEvent),dataItem:a,startColIndex:c,endColIndex:c,startRowIndex:o,endRowIndex:o,dataItems:_(),altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1,mode:R.mode,cell:R.cell,isDrag:!1,componentId:t.id,selectedField:t.gridProps.selectedField||""};g(t.gridProps.onSelectionChange,{...s,select:t.gridProps.dataItemKey?l.getSelectedState({event:s,selectedState:(r=t.gridProps.select)!=null?r:{},dataItemKey:t.gridProps.dataItemKey}):{}})}},Qe=e=>{var r;if(t.gridProps.onHeaderSelectionChange&&R.enabled){const n=_();g(t.gridProps.onHeaderSelectionChange,{select:e.syntheticEvent.target.checked?n.reduce((a,o)=>(t.gridProps.dataItemKey&&b.getter(t.gridProps.dataItemKey)(o)!==void 0&&(a[b.getter(t.gridProps.dataItemKey)(o)]=!0),a),{}):{},field:e.field,nativeEvent:e.syntheticEvent&&e.syntheticEvent.nativeEvent,syntheticEvent:e.syntheticEvent,target:E.current,dataItems:n,selectedField:(r=t.gridProps.selectedField)!=null?r:""})}},U=(e,r)=>{t.gridProps.onSelectionChange&&R.enabled&&g(t.gridProps.onSelectionChange,{...e,select:r})},Ze=e=>{var r;if(t.gridProps.onSelectionChange&&R.enabled){const n=B()[e.startRowIndex],a=B()[e.endRowIndex],o={syntheticEvent:void 0,target:E.current,selectedField:t.gridProps.selectedField||"",componentId:t.id,dataItems:_(),dataItem:null,startDataItem:n,endDataItem:a,...e},c=l.getSelectedState({event:o,selectedState:(r=t.gridProps.select)!=null?r:{},dataItemKey:t.gridProps.dataItemKey});U(o,c)}},pe=e=>{if(t.gridProps.onSelectionChange&&R.enabled){const r=e.dataItems[0],n=e.dataItems[e.dataItems.length-1],a={},o={...e,startDataItem:r,endDataItem:n,startRowIndex:0,endRowIndex:e.dataItems.length-1,startColIndex:0,endColIndex:f.current.length-1};e.dataItems.forEach(c=>{const m=b.getter(t.gridProps.dataItemKey)(c);a[m]=e.cell?[...Array(f.current.length).keys()]:!0}),U(o,a)}},et=e=>{if(t.gridProps.onSelectionChange&&R.enabled){const n=b.getter(t.gridProps.dataItemKey)(e.dataItem),a=0,o=f.current.length-1,c=e.dataItems.findIndex(y=>y[t.gridProps.dataItemKey]===e.dataItem[t.gridProps.dataItemKey]),P={...e,startDataItem:c,endDataItem:c,startRowIndex:c,endRowIndex:c,startColIndex:a,endColIndex:o},u=e.mode==="multiple"?t.gridProps.select||{}:{};u[n]===!0||Array.isArray(u[n])&&u[n].length===f.current.length?delete u[n]:u[n]=e.cell?[...Array(f.current.length).keys()]:!0,U(P,u)}},tt=e=>{t.gridProps.onSelectionChange&&R.enabled&&U(e,{})},G=(e,r,n,a,o)=>{const c=t.gridProps.onDataStateChange;if(e){const s={...C(a),...r,targetEvent:o};g(e,s)}else c&&g(c,{...C(a),targetEvent:o||{},dataState:{...ft(),...n}})},V=(e,r,n)=>{G(t.gridProps.onPageChange,{page:e},{skip:e.skip,take:e.take},r,n)},rt=()=>{let e=t.gridProps.total||0;return Array.isArray(t.gridProps.data)?e=e||t.gridProps.data.length:t.gridProps.data&&(e=e||t.gridProps.data.total),e},nt=e=>{var o,c;const r=(c=(o=t.gridProps.take)!=null?o:t.gridProps.pageSize)!=null?c:0,n=(t.gridProps.skip||0)+r,a=rt();n<a&&V({skip:n,take:r},e)},at=e=>{var a,o;const r=(o=(a=t.gridProps.take)!=null?a:t.gridProps.pageSize)!=null?o:0,n=(t.gridProps.skip||0)-r;n>=0&&V({skip:n,take:r},e)},ot=e=>{V({skip:e.skip,take:e.take},e.syntheticEvent,e.targetEvent)},Ie=(e,r)=>{G(t.gridProps.onSortChange,{sort:e},{sort:e,...t.gridProps.scrollable==="virtual"?{skip:0}:{}},r)},it=(e,r)=>{G(t.gridProps.onFilterChange,{filter:e},{filter:e||void 0,skip:0},r)},ct=e=>{const r=t.gridProps.searchFields||f.current.map(o=>o.field)||[],n=e.nativeEvent.target.value,a={logic:"or",filters:r.filter(o=>o!==void 0).map(o=>{var c;return typeof o=="string"?{field:o,value:n,operator:"contains"}:{value:n,operator:(c=o.operator)!=null?c:"contains",field:o.field,ignoreCase:o.ignoreCase}})};G(t.gridProps.onSearchChange,{search:a},{},e.syntheticEvent)},Q=(e,r)=>{const n=r.nativeEvent?r:{nativeEvent:r.nativeEvent||r.originalEvent};e.length===0&&t.gridProps.navigatable&&(ie.current=!0),G(t.gridProps.onGroupChange,{group:e},{group:e,skip:0},n)},dt=e=>{if(t.gridProps.onColumnsStateChange){const r={target:E.current,columnsState:e};g(t.gridProps.onColumnsStateChange,r)}},Z=(e,r,n)=>{const a=f.current[e],o=a.depth,c=u=>{do u++;while(u<f.current.length&&f.current[u].depth>o);return u},s=f.current.splice(e,c(e)-e);f.current.splice(e<r?c(r-s.length):r,0,...s),f.current.filter(u=>u.declarationIndex>=0).forEach((u,y)=>u.orderIndex=y);const m=f.current[e].locked&&f.current[r].locked;l.updateLeft(t.columnsMapRef,f.current,m||Y.current),l.updateRight(t.columnsMapRef,f.current,m||Y.current),oe.current&&(Y.current=!1,oe.current=!1);const P=q();if(re(),t.gridProps.onColumnReorder){const u={target:E.current,columns:P,columnId:a.id,nativeEvent:n};g(t.gridProps.onColumnReorder,u)}},F=(e,r,n)=>{const a=typeof t.gridProps.rowReorderable=="object"?t.gridProps.rowReorderable.enabled:t.gridProps.rowReorderable;if(n==="forbidden"||!a||!N.current)return;const{slicedData:o,dataRef:c}=t,s=(o||c)[r];t.gridProps.onRowReorder&&g(t.gridProps.onRowReorder,{draggedDataItems:[N.current],droppedDataItem:s==null?void 0:s.dataItem,dropPosition:n,nativeEvent:e.originalEvent,dragEvent:e,target:E.current}),N.current=null},lt=(e,r,n)=>{if(t.gridProps.group===void 0)return;const a=t.gridProps.group.slice();a.splice(r,0,...a.splice(e,1)),Q(a,n)},Ce=(e,r,n)=>{const a=f.current[e].field;if(!a)return;const o=(t.gridProps.group||[]).slice();o.splice(r,0,{field:a}),Q(o,n)},st=(e,r)=>{const n=K.current.getCurrentGroupsLength;Ce(e,n,r)},p=()=>{let e=0;if(!S.current.colGroupMain)return;const r=S.current.colGroupMain.children;for(let n=0;n<r.length;n++){const a=r[n].width;if(!a)return;e+=parseFloat(a.toString())}e=Math.round(e),z.current&&z.current.setWidth(e),O.current&&O.current.setWidth(e),k.current&&(k.current.style.width=e+"px")},W=i.useCallback((e,r,n,a,o)=>{var P;if(!ut()&&!n||!e)return;const c={type:e,nativeEvent:r,columns:f.current,dataItemKey:t.gridProps.dataItemKey||"",dataItem:a,field:o,...typeof t.gridProps.clipboard!="boolean"?t.gridProps.clipboard:{},...n},s=B(),m=l.populateClipboardData({event:c,data:s,selectedState:(P=t.gridProps.select)!=null?P:{},previousCopiedItems:Ee.current});e!==l.ClipboardActionType.paste&&(Ee.current=m.copiedItems),t.gridProps.onClipboard&&v&&g(t.gridProps.onClipboard,{...c,...m})},[t.gridProps.select,t.gridProps.dataItemKey,t.gridProps.data,t.gridProps.clipboard,t.gridProps.onClipboard]),ut=()=>{var o,c,s;if(!b.canUseDOM)return!1;const e=b.getActiveElement(x()),r=e?e.matches(".k-table-td")?e:(o=x())==null?void 0:o.body:(c=x())==null?void 0:c.body,n=r.closest(".k-grid-container"),a=r&&((s=A.current)==null?void 0:s.contains(r));return!!(r&&a&&n)},gt=(e,r,n,a,o,c)=>{p(),Y.current=!0,oe.current=!0,t.gridProps.onColumnResize&&v&&g(t.gridProps.onColumnResize,{columns:q(),nativeEvent:a,targetColumnId:c,index:e,newWidth:r,oldWidth:n,end:o,target:E.current})},ft=()=>{var e;return{filter:t.gridProps.filter,sort:t.gridProps.sort,skip:t.gridProps.skip,take:(e=t.gridProps.take)!=null?e:t.gridProps.pageSize,group:t.gridProps.group}},C=e=>({nativeEvent:e&&e.nativeEvent,syntheticEvent:e,target:E.current}),mt=e=>({...e,nativeEvent:void 0,syntheticEvent:void 0,target:void 0,targetEvent:void 0,focusElement:void 0}),g=(e,r)=>{if(t.gridProps.isClient){e(r);return}e(mt(r))},Pt=()=>{var e,r,n;if(L.current&&((e=L.current)==null?void 0:e.getElementsByClassName("k-grid-edit-row").length)>0){de.current=!1,(r=document.activeElement)!=null&&r.closest(".k-grid-edit-row")?ce.current=document.activeElement:ce.current=void 0;const a=Array.from((n=L.current)==null?void 0:n.getElementsByClassName("k-grid-edit-row"));a.length>ge.current.length?J.current=a.filter(o=>!ge.current.includes(o))[0]:a.length===1&&(J.current=a[0],de.current=!0),ge.current=a}},_=()=>t.dataRef.filter(e=>e.rowType==="data").map(e=>e.dataItem),B=()=>(t.slicedData||t.dataRef).filter(e=>e.rowType==="data").map(e=>e.dataItem),ee=()=>(ae.current||(ae.current=b.getScrollbarWidth()||void 0),ae.current),x=()=>{var e;if(b.canUseDOM)return((e=j())==null?void 0:e.ownerDocument)||document},j=()=>A.current,te=i.useCallback(e=>{var a;if(!d.current||!((a=d.current)!=null&&a.container)||t.gridProps.scrollable==="none")return;T.current&&T.current.disconnect();const{rowIndex:r}=e,n=j();if(t.gridProps.scrollable==="virtual")d.current.askedSkip=r,d.current.container.scroll(0,Math.round(d.current.askedSkip/d.current.total*d.current.container.scrollHeight));else if(n){const o=r<1?n.querySelector("tbody > tr:nth-child(1)"):n.querySelector(`tbody > tr:nth-child(${r+1})`);o&&X.current&&(X.current.scrollTop=o.offsetTop)}},[t.gridProps.scrollable]),Re=e=>JSON.stringify(e.map(r=>({id:r.id,field:r.field,title:r.title,children:r.children}))),ht=()=>Re(xt)===Re(f.current),bt=()=>{ht()||re()},It=()=>{const{data:e,total:r}=t.gridProps;return Array.isArray(e)?e.length===r:e?r===e.total:!1},Ct=(e,r)=>{var n,a;if(d.current){if(d.current.fixedScroll=t.gridProps.fixedScroll||!1,d.current.PageChange=V,d.current.realSkip=t.gridProps.skip||0,d.current.pageSize=(a=(n=t.gridProps.take)!=null?n:t.gridProps.pageSize)!=null?a:0,d.current.scrollableVirtual=t.gridProps.scrollable==="virtual",d.current.total=e,d.current.propsSkip=(t.gridProps.skip||0)+(t.gridProps.scrollable==="virtual"?d.current.topCacheCount+(d.current.attendedSkip-(t.gridProps.skip||0)):0),t.gridProps.rowHeight!==void 0&&t.gridProps.rowHeight>0&&!r){const o=t.gridProps.rowHeight*e;d.current.containerHeight=w.firefox?Math.min(w.firefoxMaxHeight,o):o}else d.current.containerHeight=1533915;if(d.current.containerRef=X,d.current.tableBodyRef=L,d.current.table=k.current,d.current instanceof Ae.VirtualScrollFixed){const{rowHeight:o=0,detail:c,expandField:s}=t.gridProps;let{detailRowHeight:m=0}=t.gridProps;m=c&&s?m:o,It()?(d.current.total=t.dataRef.length,d.current.rowHeightService=new b.RowHeightService(t.dataRef.length,o,m,t.dataRef)):d.current.rowHeightService=new b.RowHeightService(e,o,m);const P=d.current.rowHeightService.totalHeight();d.current.containerHeight=w.firefox?Math.min(w.firefoxMaxHeight,P):P}}},Rt=()=>{const e=n=>n.map(a=>({id:a.id,field:a.field,title:a.title,hidden:!1,children:a.children?e(a.children):null})),r=t.columnsRef.current.filter(n=>n.depth===0);return e(r)},ve=i.useCallback(e=>{const r={rowIndex:ue.current};e.forEach(n=>{n.isIntersecting||te(r)})},[te]),re=()=>{t.gridProps.forceUpdate&&t.gridProps.forceUpdate()},vt=e=>e.left!==void 0?ye!=="rtl"?{left:e.left,right:e.right}:{left:e.right,right:e.left}:{},E=i.useRef(null),f=t.columnsRef,d=i.useRef(),S=i.useRef(),K=i.useRef(),D=i.useRef(),M=i.useRef(),$=i.useRef(),T=i.useRef(null),L=i.useRef(null),Et=i.useRef(null),X=i.useRef(null),k=i.useRef(null),ne=i.useRef(null),A=i.useRef(null),O=i.useRef(null),z=i.useRef(null),ae=i.useRef(),oe=i.useRef(!1),ie=i.useRef(!1),J=i.useRef(),ce=i.useRef(),de=i.useRef(!1),Y=i.useRef(!0),le=i.useRef(0),se=i.useRef(),ue=i.useRef(),ge=i.useRef([]),Ee=i.useRef([]),N=i.useRef(null),yt=i.useRef(null),wt=i.useRef(null),ye=b.useDir(A),xt=i.useMemo(()=>i.Children.toArray(t.gridProps.children),[t.gridProps.children]),R=l.getSelectionOptions((Se=t.gridProps.selectable)!=null?Se:!!t.gridProps.selectedField),we=l.getEditableOptions((De=t.gridProps.editable)!=null?De:!!t.gridProps.editField);i.useMemo(()=>{l.tableKeyboardNavigation.onConstructor({navigatable:!!t.gridProps.navigatable,contextStateRef:D,navigationStateRef:M,idPrefix:t.id})},[]),i.useMemo(()=>{var n;(n=d.current)==null||n.reset();const e=t.gridProps.groupable===!0||typeof t.gridProps.groupable=="object"&&t.gridProps.groupable.enabled!==!1,r=t.isFixedVirtualScroll?Ae.VirtualScrollFixed:Gt.VirtualScroll;d.current=new r(e||t.gridProps.rowHeight===void 0||t.gridProps.rowHeight===0)},[t.gridProps.scrollable,t.gridProps.total,t.gridProps.filter,t.gridProps.group,t.gridProps.groupable,t.gridProps.sort,t.gridProps.rowHeight]),i.useEffect(()=>(t.gridProps.clipboard&&($.current=new l.ClipboardService(W),$.current.addEventListeners(x())),()=>{$.current&&$.current.removeEventListeners(x())}),[t.gridProps.onClipboard,t.gridProps.clipboard,W,x]),i.useEffect(()=>(t.gridProps.columnVirtualization&&!window.navigator.userAgent.match(Ht.SAFARI_REGEX)&&(ne.current&&(ne.current.style.display="block"),k.current&&(k.current.style.display="block")),p(),b.setScrollbarWidth(ee()),l.tableKeyboardNavigation.onComponentDidMount({scope:A.current||void 0,contextStateRef:D,navigationStateRef:M}),()=>{clearTimeout(se.current)}),[]),i.useEffect(()=>{var e;p(),b.setScrollbarWidth(ee()),(e=d.current)!=null&&e.tableTransform&&d.current.table&&(d.current.table.style.transform=d.current.tableTransform,d.current.tableTransform=""),Pt(),l.tableKeyboardNavigation.onComponentDidUpdate({scope:A.current||void 0,contextStateRef:D,navigationStateRef:M,focusFirst:ie.current,newEditableRow:J.current,singleEditRow:de.current,lastActiveElement:ce.current,navigatable:t.gridProps.navigatable}),ie.current=!1,J.current=void 0}),i.useEffect(()=>{if(b.canUseDOM){const e={rootMargin:"0px",threshold:.9};T.current=window.IntersectionObserver&&new window.IntersectionObserver(ve,e)||null}},[ve]),i.useEffect(()=>{var r;let e;return b.canUseDOM&&window.ResizeObserver&&(e=new window.ResizeObserver(bt),e.observe((r=x())==null?void 0:r.body)),()=>{e==null||e.disconnect()}},[]),i.useImperativeHandle(E,()=>({get element(){return j()},props:t.gridProps,get columns(){return q()},scrollIntoView:e=>{var a;if(!((a=d.current)!=null&&a.container)||t.gridProps.scrollable==="none")return;const{rowIndex:r}=e;ue.current=r;const n=j();if(T.current&&n){T.current.disconnect();const o=n.querySelector(`[absolute-row-index="${ue.current}"]`);o?T.current.observe(o):te(e)}},fitColumns:e=>{S.current.dblClickHandler(null,e)}})),i.useImperativeHandle(t.gridRef,()=>E.current),i.useMemo(()=>{S.current=new Tt.ColumnResize(gt)},[t.gridProps.onColumnResize]),i.useMemo(()=>{K.current=new At.CommonDragLogic(Z,lt,Ce)},[t.gridProps.onColumnReorder,t.gridProps.onGroupChange,t.gridProps.group,t.gridProps.groupable]),S.current.resizable=t.gridProps.resizable||!1,S.current.columns=f.current;const xe=t.gridProps.groupable===!0||typeof t.gridProps.groupable=="object"&&t.gridProps.groupable.enabled!==!1;K.current.reorderable=t.gridProps.reorderable||!1,K.current.groupable=xe,K.current.columns=f.current,Ct(t.total,xe);const St=t.gridProps.columnsState||Rt();return i.createElement(Fe.Provider,{value:{isClient:v,rowReorder:F,activeDragRowDataItemRef:N,reorderRowDragTargetRef:yt,reorderRowDropTargetRef:wt,dir:ye,getCellPositionStyle:vt,dataItemKey:t.gridProps.dataItemKey,columnsState:St,onColumnsStateChange:dt,groupChange:Q,selectionRelease:Ze,pagerPageChange:ot,onContextMenu:Ne,rowClick:_e,rowDblClick:Be,cellClick:je,headerCellClick:be,itemChange:Je,sortChange:Ie,filterChange:it,searchChange:ct,onHeaderSelectionChange:Qe,columnGroupChange:st,onKeyDown:Ue,onFocus:Ve,scrollHandler:qe,selectionChange:Ye,dispatchDetailExpand:$e,dispatchGroupExpand:Xe,columnResizeRef:S,dragLogicRef:K,navigationStateRef:M,tableElementRef:k,tableBodyElementRef:L,headerElementRef:Et,containerElementRef:X,headTableElementRef:ne,elementRef:A,footerRef:O,headerRef:z,getCachedScrollbarWidth:ee,vsRef:d}},i.createElement(l.TableKeyboardNavigationContext.Provider,{value:D.current},t.children),i.createElement(Ft.GridContextMenu,{show:h.show,dataItem:h.dataItem,field:h.field,items:Oe,offset:h.offset,onClose:me,onSelect:ze}))};exports.GridClientWrapper=Ot;exports.GridContext=Fe;
